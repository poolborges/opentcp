<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>tcp.c File Reference</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.18 -->
<center>
<a class="qindex" href="main.html">Main Page</a> &nbsp; <a class="qindex" href="modules.html">Modules</a> &nbsp; <a class="qindex" href="annotated.html">Data Structures</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Data Fields</a> &nbsp; <a class="qindex" href="globals.html">Globals</a> &nbsp; <a class="qindex" href="pages.html">Related Pages</a> &nbsp; <a class="qindex" href="examples.html">Examples</a> &nbsp; </center>
<hr><h1>/opentcp/tcp.c File Reference</h1><hr><a name="_details"></a><h2>Detailed Description</h2>
 <dl compact><dt><b>Author: </b></dt><dd>
 <ul>
<li> Jari Lahti (<a href="mailto:jari.lahti@violasystems.com">jari.lahti@violasystems.com</a>) <li> Vladan Jovanovic (<a href="mailto:vladan.jovanovic@violasystems.com">vladan.jovanovic@violasystems.com</a>) </ul>
</dl><dl compact><dt><b>Version: </b></dt><dd>
1.0 </dl><dl compact><dt><b>Date: </b></dt><dd>
10.7.2002 </dl><dl compact><dt><b><a class="el" href="bug.html#_bug000021">Bug: </a></b></dt><dd>
</dl> <dl compact><dt><b>Warning: </b></dt><dd>
 </dl><dl compact><dt><b><a class="el" href="todo.html#_todo000023">Todo: </a></b></dt><dd>
<ul>
<li> Check if tcp_tempbuf can be thrown out and net_buf used instead. Application normally don't use the first part of tcp_tempbuf anyway and there shouldn't be any overlapping with other applications (TCP/UDP) either. <li> There's probably no need for that <b>+1</b> for determining the size of tcp_tempbuf. But if previous TODO is possible, this isn't important anyway. <li> Implement per-socket window size (just add API function)</dl></ul>
OpenTCP TCP implementation. All functions necessary for TCP processing are present here. Note that only a small subset of these functions must be used for "normal" applications that are using the TCP for communciation. For function declarations and lots of other usefull stuff see <a class="el" href="tcp__ip_8h.html">inet/tcp_ip.h</a>.
<p>
For examples how to use TCP and write applications that communicate using TCP see inet/demo/main_demo.c, inet/demo/tcp_client_demo.c and inet/demo/tcp_server_demo.c.
<p>

<p>
Definition in file <a class="el" href="tcp_8c-source.html">tcp.c</a>.
<p>
<a href="tcp_8c-source.html">Go to the source code of this file.</a><table border=0 cellpadding=0 cellspacing=0>
<tr><td></td></tr>
<tr><td colspan=2><br><h2>Functions</h2></td></tr>
<tr><td nowrap align=right valign=top>INT8&nbsp;</td><td valign=bottom><a class="el" href="tcp_8c.html#a3">tcp_getsocket</a> (UINT8 soctype, UINT8 tos, UINT16 tout, INT32(*listener)(INT8, UINT8, UINT32, UINT32))</td></tr>
<tr><td>&nbsp;</td><td><font size=-1><em>Allocate a free socket in TCP socket pool.</em> <a href="#a3"></a><em></em></font><br><br></td></tr>
<tr><td nowrap align=right valign=top>INT8&nbsp;</td><td valign=bottom><a class="el" href="tcp_8c.html#a4">tcp_releasesocket</a> (INT8 sochandle)</td></tr>
<tr><td>&nbsp;</td><td><font size=-1><em>Release a TCP socket.</em> <a href="#a4"></a><em></em></font><br><br></td></tr>
<tr><td nowrap align=right valign=top>INT8&nbsp;</td><td valign=bottom><a class="el" href="tcp_8c.html#a5">tcp_listen</a> (INT8 sochandle, UINT16 port)</td></tr>
<tr><td>&nbsp;</td><td><font size=-1><em>Put TCP socket to listen on a given port.</em> <a href="#a5"></a><em></em></font><br><br></td></tr>
<tr><td nowrap align=right valign=top>INT8&nbsp;</td><td valign=bottom><a class="el" href="tcp_8c.html#a6">tcp_connect</a> (INT8 sochandle, UINT32 ip, UINT16 rport, UINT16 myport)</td></tr>
<tr><td>&nbsp;</td><td><font size=-1><em>Initialize connection establishment towards remote IP&amp;port.</em> <a href="#a6"></a><em></em></font><br><br></td></tr>
<tr><td nowrap align=right valign=top>INT16&nbsp;</td><td valign=bottom><a class="el" href="tcp_8c.html#a7">tcp_send</a> (INT8 sockethandle, UINT8 *buf, UINT16 blen, UINT16 dlen)</td></tr>
<tr><td>&nbsp;</td><td><font size=-1><em>Send user data over TCP using given TCP socket.</em> <a href="#a7"></a><em></em></font><br><br></td></tr>
<tr><td nowrap align=right valign=top>INT8&nbsp;</td><td valign=bottom><a class="el" href="tcp_8c.html#a8">tcp_close</a> (INT8 sochandle)</td></tr>
<tr><td>&nbsp;</td><td><font size=-1><em>Initiate TCP connection closing procedure.</em> <a href="#a8"></a><em></em></font><br><br></td></tr>
<tr><td nowrap align=right valign=top>INT8&nbsp;</td><td valign=bottom><a class="el" href="tcp_8c.html#a9">tcp_getstate</a> (INT8 sochandle)</td></tr>
<tr><td>&nbsp;</td><td><font size=-1><em>Get current state of the socket.</em> <a href="#a9"></a><em></em></font><br><br></td></tr>
<tr><td nowrap align=right valign=top>INT16&nbsp;</td><td valign=bottom><a class="el" href="tcp_8c.html#a10">tcp_checksend</a> (INT8 sochandle)</td></tr>
<tr><td>&nbsp;</td><td><font size=-1><em>Checks if it's possible to send data using given socket.</em> <a href="#a10"></a><em></em></font><br><br></td></tr>
<tr><td nowrap align=right valign=top>INT8&nbsp;</td><td valign=bottom><a class="el" href="tcp_8c.html#a11">tcp_abort</a> (INT8 sochandle)</td></tr>
<tr><td>&nbsp;</td><td><font size=-1><em>Reset connection and place socket to closed state.</em> <a href="#a11"></a><em></em></font><br><br></td></tr>
<tr><td nowrap align=right valign=top>void&nbsp;</td><td valign=bottom><a class="el" href="tcp_8c.html#a12">tcp_poll</a> (void)</td></tr>
<tr><td>&nbsp;</td><td><font size=-1><em>Poll TCP sockets periodically.</em> <a href="#a12"></a><em></em></font><br><br></td></tr>
<tr><td nowrap align=right valign=top>INT8&nbsp;</td><td valign=bottom><a class="el" href="tcp_8c.html#a13">tcp_init</a> (void)</td></tr>
<tr><td>&nbsp;</td><td><font size=-1><em>Initialize TCP module.</em> <a href="#a13"></a><em></em></font><br><br></td></tr>
<tr><td nowrap align=right valign=top>INT16&nbsp;</td><td valign=bottom><a class="el" href="tcp_8c.html#a14">process_tcp_in</a> (struct <a class="el" href="structip__frame.html">ip_frame</a> *frame, UINT16 len)</td></tr>
<tr><td>&nbsp;</td><td><font size=-1><em>Check and process the received TCP frame.</em> <a href="#a14"></a><em></em></font><br><br></td></tr>
<tr><td nowrap align=right valign=top>INT16&nbsp;</td><td valign=bottom><a class="el" href="tcp_8c.html#a15">process_tcp_out</a> (INT8 sockethandle, UINT8 *buf, UINT16 blen, UINT16 dlen)</td></tr>
<tr><td>&nbsp;</td><td><font size=-1><em>Create and send TCP packet.</em> <a href="#a15"></a><em></em></font><br><br></td></tr>
<tr><td nowrap align=right valign=top>void&nbsp;</td><td valign=bottom><a class="el" href="tcp_8c.html#a16">tcp_sendcontrol</a> (INT8 sockethandle)</td></tr>
<tr><td>&nbsp;</td><td><font size=-1><em>Send a TCP control packet (no data).</em> <a href="#a16"></a><em></em></font><br><br></td></tr>
<tr><td nowrap align=right valign=top>void&nbsp;</td><td valign=bottom><a class="el" href="tcp_8c.html#a17">tcp_sendreset</a> (struct <a class="el" href="structtcp__frame.html">tcp_frame</a> *frame, UINT32 remip)</td></tr>
<tr><td>&nbsp;</td><td><font size=-1><em>Send a reset (RST) packet to remote host.</em> <a href="#a17"></a><em></em></font><br><br></td></tr>
<tr><td nowrap align=right valign=top>UINT32&nbsp;</td><td valign=bottom><a class="el" href="tcp_8c.html#a18">tcp_initseq</a> (void)</td></tr>
<tr><td>&nbsp;</td><td><font size=-1><em>Get and return initial sequence number.</em> <a href="#a18"></a><em></em></font><br><br></td></tr>
<tr><td nowrap align=right valign=top>INT8&nbsp;</td><td valign=bottom><a class="el" href="tcp_8c.html#a19">tcp_mapsocket</a> (struct <a class="el" href="structip__frame.html">ip_frame</a> *ipframe, struct <a class="el" href="structtcp__frame.html">tcp_frame</a> *tcpframe)</td></tr>
<tr><td>&nbsp;</td><td><font size=-1><em>Try to match received TCP packet to a socket.</em> <a href="#a19"></a><em></em></font><br><br></td></tr>
<tr><td nowrap align=right valign=top>void&nbsp;</td><td valign=bottom><a class="el" href="tcp_8c.html#a20">tcp_newstate</a> (struct <a class="el" href="structtcb.html">tcb</a> *soc, UINT8 nstate)</td></tr>
<tr><td>&nbsp;</td><td><font size=-1><em>Change TCP socket state and reinitialize timers.</em> <a href="#a20"></a><em></em></font><br><br></td></tr>
<tr><td nowrap align=right valign=top>UINT16&nbsp;</td><td valign=bottom><a class="el" href="tcp_8c.html#a21">tcp_getfreeport</a> (void)</td></tr>
<tr><td>&nbsp;</td><td><font size=-1><em>Returns next free (not used) local port number.</em> <a href="#a21"></a><em></em></font><br><br></td></tr>
<tr><td nowrap align=right valign=top>UINT8&nbsp;</td><td valign=bottom><a class="el" href="tcp_8c.html#a22">tcp_check_cs</a> (struct <a class="el" href="structip__frame.html">ip_frame</a> *ipframe, UINT16 len)</td></tr>
<tr><td>&nbsp;</td><td><font size=-1><em>Check if TCP checksum check's out.</em> <a href="#a22"></a><em></em></font><br><br></td></tr>
<tr><td colspan=2><br><h2>Variables</h2></td></tr>
<tr><td nowrap align=right valign=top><a class="el" href="structtcp__frame.html">tcp_frame</a>&nbsp;</td><td valign=bottom><a class="el" href="tcp_8c.html#a0">received_tcp_packet</a></td></tr>
<tr><td>&nbsp;</td><td><font size=-1><em>Used for storing field information about the received TCP packet.</em> <a href="#a0"></a><em></em></font><br><br></td></tr>
<tr><td nowrap align=right valign=top><a class="el" href="structtcb.html">tcb</a>&nbsp;</td><td valign=bottom><a class="el" href="tcp_8c.html#a1">tcp_socket</a> [NO_OF_TCPSOCKETS+1]</td></tr>
<tr><td>&nbsp;</td><td><font size=-1><em>TCP table holding connection parameters for every TCP socket.</em> <a href="#a1"></a><em></em></font><br><br></td></tr>
<tr><td nowrap align=right valign=top>UINT8&nbsp;</td><td valign=bottom><a class="el" href="tcp_8c.html#a2">tcp_tempbuf</a> [MIN_TCP_HLEN+1]</td></tr>
</table>
<hr><h2>Function Documentation</h2>
<a name="a3" doxytag="tcp.c::tcp_getsocket"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> INT8 tcp_getsocket </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">UINT8&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>soctype</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>UINT8&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>tos</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>UINT16&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>tout</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>INT32(*&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>listener</em>)(INT8, UINT8, UINT32, UINT32)</td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<dl compact><dt><b>Author: </b></dt><dd>
 <ul>
<li> Jari Lahti (<a href="mailto:jari.lahti@violasystems.com">jari.lahti@violasystems.com</a>) </ul>
</dl><dl compact><dt><b>Date: </b></dt><dd>
21.07.2002 </dl><dl compact><dt><b>Parameters: </b></dt><dd>
<table border=0 cellspacing=2 cellpadding=0>
<tr><td valign=top><em>soctype</em>&nbsp;</td><td>
type of socket wanted. Can take one of the following values: <ul>
<li> <a class="el" href="tcp__ip_8h.html#a38">TCP_TYPE_NONE</a> <li> <a class="el" href="tcp__ip_8h.html#a39">TCP_TYPE_SERVER</a> <li> <a class="el" href="tcp__ip_8h.html#a40">TCP_TYPE_CLIENT</a> <li> <a class="el" href="tcp__ip_8h.html#a41">TCP_TYPE_CLIENT_SERVER</a> </ul>
</td></tr>
<tr><td valign=top><em>tos</em>&nbsp;</td><td>
type of service for socket. For now only <a class="el" href="tcp__ip_8h.html#a18">TCP_TOS_NORMAL</a>. </td></tr>
<tr><td valign=top><em>tout</em>&nbsp;</td><td>
Timeout of socket in seconds. Defines after how many seconds of inactivity (application not sending and/or receiving any data over TCP connection) will the TCP socket automatically be closed. </td></tr>
<tr><td valign=top><em>listener</em>&nbsp;</td><td>
pointer to callback function that will be invoked by the TCP/IP stack to inform socket application of certain events. See <a class="el" href="tcp__client__demo_8c.html#a7">tcpc_demo_eventlistener()</a> and <a class="el" href="tcp__server__demo_8c.html#a5">tcps_demo_eventlistener()</a> for more information on events and possible actions. </td></tr>
</table>
</dl><dl compact><dt><b>Returns: </b></dt><dd>
 <ul>
<li> -1 - Error getting requested socket <li> &gt;=0 - Handle to reserved socket</ul>
</dl>Invoke this function to try to obtain a free socket from TCP socket pool. Function returns a handle to the free socket that is later used for  accessing the allocated socket (opening, connecting, sending data, closing, aborting, etc.). 
<p>
Definition at line <a class="el" href="tcp_8c-source.html#l00155">155</a> of file <a class="el" href="tcp_8c-source.html">tcp.c</a>.
<p>
References <a class="el" href="structtcb.html#m16">tcb::event_listener</a>, <a class="el" href="tcp__ip_8h-source.html#l00622">tcb::flags</a>, <a class="el" href="tcp__ip_8h-source.html#l00625">tcb::locport</a>, <a class="el" href="tcp__ip_8h-source.html#l00623">tcb::rem_ip</a>, <a class="el" href="tcp__ip_8h-source.html#l00624">tcb::remport</a>, <a class="el" href="tcp__ip_8h-source.html#l00609">tcb::state</a>, <a class="el" href="tcp__ip_8h-source.html#l00333">TCP_STATE_FREE</a>, <a class="el" href="tcp__ip_8h-source.html#l00334">TCP_STATE_RESERVED</a>, <a class="el" href="tcp__ip_8h-source.html#l00320">TCP_TYPE_CLIENT</a>, <a class="el" href="tcp__ip_8h-source.html#l00329">TCP_TYPE_CLIENT_SERVER</a>, <a class="el" href="tcp__ip_8h-source.html#l00300">TCP_TYPE_NONE</a>, <a class="el" href="tcp__ip_8h-source.html#l00310">TCP_TYPE_SERVER</a>, <a class="el" href="timers_8h-source.html#l00086">TIMERTIC</a>, <a class="el" href="tcp__ip_8h-source.html#l00631">tcb::tos</a>, <a class="el" href="tcp__ip_8h-source.html#l00630">tcb::tout</a>, and <a class="el" href="tcp__ip_8h-source.html#l00621">tcb::type</a>.
<p>
Referenced by <a class="el" href="http__server_8c-source.html#l00093">https_init()</a>, <a class="el" href="pop3__client_8c-source.html#l00148">pop3c_init()</a>, and <a class="el" href="smtp__client_8c-source.html#l00155">smtpc_init()</a>.    </td>
  </tr>
</table>
<a name="a4" doxytag="tcp.c::tcp_releasesocket"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> INT8 tcp_releasesocket </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">INT8&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>&nbsp; <em>sochandle</em>          </td>
          <td class="md" valign="top">)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<dl compact><dt><b>Author: </b></dt><dd>
 <ul>
<li> Jari Lahti (<a href="mailto:jari.lahti@violasystems.com">jari.lahti@violasystems.com</a>) </ul>
</dl><dl compact><dt><b>Date: </b></dt><dd>
21.07.2002 </dl><dl compact><dt><b>Parameters: </b></dt><dd>
<table border=0 cellspacing=2 cellpadding=0>
<tr><td valign=top><em>sochandle</em>&nbsp;</td><td>
handle to socket to be released </td></tr>
</table>
</dl><dl compact><dt><b>Returns: </b></dt><dd>
 <ul>
<li> -1 - Error releasing the socket (Wrong socket handle or socket not in proper state to be released) <li> &gt;=0 - handle of the released socket (can not be used any more untill allocated again with <a class="el" href="tcp_8c.html#a3">tcp_getsocket()</a>).</ul>
</dl>Once the application does not need the TCP socket any more it can invoke this function in order to release it. This is usefull if there is a very limited number of sockets (in order to save some memory) shared among several applications. 
<p>
Definition at line <a class="el" href="tcp_8c-source.html#l00228">228</a> of file <a class="el" href="tcp_8c-source.html">tcp.c</a>.
<p>
References <a class="el" href="structtcb.html#m16">tcb::event_listener</a>, <a class="el" href="tcp__ip_8h-source.html#l00622">tcb::flags</a>, <a class="el" href="tcp__ip_8h-source.html#l00625">tcb::locport</a>, <a class="el" href="tcp__ip_8h-source.html#l00623">tcb::rem_ip</a>, <a class="el" href="tcp__ip_8h-source.html#l00624">tcb::remport</a>, <a class="el" href="tcp__ip_8h-source.html#l00609">tcb::state</a>, <a class="el" href="tcp__ip_8h-source.html#l00335">TCP_STATE_CLOSED</a>, <a class="el" href="tcp__ip_8h-source.html#l00333">TCP_STATE_FREE</a>, <a class="el" href="tcp__ip_8h-source.html#l00334">TCP_STATE_RESERVED</a>, <a class="el" href="tcp__ip_8h-source.html#l00300">TCP_TYPE_NONE</a>, <a class="el" href="tcp__ip_8h-source.html#l00631">tcb::tos</a>, and <a class="el" href="tcp__ip_8h-source.html#l00621">tcb::type</a>.    </td>
  </tr>
</table>
<a name="a5" doxytag="tcp.c::tcp_listen"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> INT8 tcp_listen </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">INT8&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>sochandle</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>UINT16&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>port</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<dl compact><dt><b>Author: </b></dt><dd>
 <ul>
<li> Jari Lahti (<a href="mailto:jari.lahti@violasystems.com">jari.lahti@violasystems.com</a>) </ul>
</dl><dl compact><dt><b>Date: </b></dt><dd>
21.07.2002 </dl><dl compact><dt><b>Parameters: </b></dt><dd>
<table border=0 cellspacing=2 cellpadding=0>
<tr><td valign=top><em>sochandle</em>&nbsp;</td><td>
handle to socket to be placed to listen state </td></tr>
<tr><td valign=top><em>port</em>&nbsp;</td><td>
TCP port number on which it should listen </td></tr>
</table>
</dl><dl compact><dt><b>Returns: </b></dt><dd>
 <ul>
<li> -1 - Error <li> &gt;=0 - OK (Socket put to listening state. Handle to  socket returned)</ul>
</dl>This function will attempt to put socket to listening state. This is only possible if socket was defined as either <a class="el" href="tcp__ip_8h.html#a39">TCP_TYPE_SERVER</a> or <a class="el" href="tcp__ip_8h.html#a41">TCP_TYPE_CLIENT_SERVER</a>. If basic correctness checks pass, socket is  put to listening mode and corresponding tcb entry is initialized. 
<p>
Definition at line <a class="el" href="tcp_8c-source.html#l00290">290</a> of file <a class="el" href="tcp_8c-source.html">tcp.c</a>.
<p>
References <a class="el" href="structtcb.html#m16">tcb::event_listener</a>, <a class="el" href="tcp__ip_8h-source.html#l00622">tcb::flags</a>, <a class="el" href="tcp__ip_8h-source.html#l00625">tcb::locport</a>, <a class="el" href="tcp__ip_8h-source.html#l00627">tcb::myflags</a>, <a class="el" href="tcp__ip_8h-source.html#l00632">tcb::receive_next</a>, <a class="el" href="tcp__ip_8h-source.html#l00623">tcb::rem_ip</a>, <a class="el" href="tcp__ip_8h-source.html#l00624">tcb::remport</a>, <a class="el" href="tcp__ip_8h-source.html#l00635">tcb::retries_left</a>, <a class="el" href="tcp__ip_8h-source.html#l00629">tcb::send_mtu</a>, <a class="el" href="tcp__ip_8h-source.html#l00628">tcb::send_next</a>, <a class="el" href="tcp__ip_8h-source.html#l00626">tcb::send_unacked</a>, <a class="el" href="tcp__ip_8h-source.html#l00609">tcb::state</a>, <a class="el" href="tcp__ip_8h-source.html#l00335">TCP_STATE_CLOSED</a>, <a class="el" href="tcp__ip_8h-source.html#l00336">TCP_STATE_LISTENING</a>, <a class="el" href="tcp__ip_8h-source.html#l00334">TCP_STATE_RESERVED</a>, <a class="el" href="tcp__ip_8h-source.html#l00359">TCP_STATE_TIMED_WAIT</a>, <a class="el" href="tcp__ip_8h-source.html#l00310">TCP_TYPE_SERVER</a>, and <a class="el" href="tcp__ip_8h-source.html#l00621">tcb::type</a>.
<p>
Referenced by <a class="el" href="http__server_8c-source.html#l00093">https_init()</a>.    </td>
  </tr>
</table>
<a name="a6" doxytag="tcp.c::tcp_connect"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> INT8 tcp_connect </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">INT8&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>sochandle</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>UINT32&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>ip</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>UINT16&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>rport</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>UINT16&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>myport</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<dl compact><dt><b>Author: </b></dt><dd>
 <ul>
<li> Jari Lahti (<a href="mailto:jari.lahti@violasystems.com">jari.lahti@violasystems.com</a>) </ul>
</dl><dl compact><dt><b>Date: </b></dt><dd>
21.07.2002 </dl><dl compact><dt><b>Parameters: </b></dt><dd>
<table border=0 cellspacing=2 cellpadding=0>
<tr><td valign=top><em>sochandle</em>&nbsp;</td><td>
handle to socket to be used for connection establishment </td></tr>
<tr><td valign=top><em>ip</em>&nbsp;</td><td>
remote IP address to connect to  </td></tr>
<tr><td valign=top><em>rport</em>&nbsp;</td><td>
remote port number to connect to </td></tr>
<tr><td valign=top><em>myport</em>&nbsp;</td><td>
local port to use for connection. This value can be specified directly or, if a value of 0 is given, TCP module will determine local TCP port automatically. </td></tr>
</table>
</dl><dl compact><dt><b>Returns: </b></dt><dd>
 <ul>
<li> -1 - Error <li> &gt;=0 - OK (Connection establishment procedure started. Socket handle returned.)</ul>
</dl>Invoke this function to start connection establishment procedure towards remote host over some socket. This is only possible if socket was defined as either <a class="el" href="tcp__ip_8h.html#a40">TCP_TYPE_CLIENT</a> or <a class="el" href="tcp__ip_8h.html#a41">TCP_TYPE_CLIENT_SERVER</a>. Function  will make some basic checks and if everything is OK, corresponding tcb socket entry will be initialized and connection procedure started. 
<p>
Definition at line <a class="el" href="tcp_8c-source.html#l00377">377</a> of file <a class="el" href="tcp_8c-source.html">tcp.c</a>.
<p>
References <a class="el" href="structtcb.html#m16">tcb::event_listener</a>, <a class="el" href="tcp__ip_8h-source.html#l00622">tcb::flags</a>, <a class="el" href="tcp__ip_8h-source.html#l00625">tcb::locport</a>, <a class="el" href="tcp__ip_8h-source.html#l00627">tcb::myflags</a>, <a class="el" href="tcp__ip_8h-source.html#l00623">tcb::rem_ip</a>, <a class="el" href="tcp__ip_8h-source.html#l00624">tcb::remport</a>, <a class="el" href="tcp__ip_8h-source.html#l00629">tcb::send_mtu</a>, <a class="el" href="tcp__ip_8h-source.html#l00628">tcb::send_next</a>, <a class="el" href="tcp__ip_8h-source.html#l00626">tcb::send_unacked</a>, <a class="el" href="tcp__ip_8h-source.html#l00609">tcb::state</a>, <a class="el" href="tcp_8c-source.html#l02511">tcp_getfreeport()</a>, <a class="el" href="tcp_8c-source.html#l02346">tcp_initseq()</a>, <a class="el" href="tcp_8c-source.html#l02455">tcp_newstate()</a>, <a class="el" href="tcp_8c-source.html#l02253">tcp_sendcontrol()</a>, <a class="el" href="tcp__ip_8h-source.html#l00335">TCP_STATE_CLOSED</a>, <a class="el" href="tcp__ip_8h-source.html#l00336">TCP_STATE_LISTENING</a>, <a class="el" href="tcp__ip_8h-source.html#l00334">TCP_STATE_RESERVED</a>, <a class="el" href="tcp__ip_8h-source.html#l00343">TCP_STATE_SYN_SENT</a>, <a class="el" href="tcp__ip_8h-source.html#l00320">TCP_TYPE_CLIENT</a>, and <a class="el" href="tcp__ip_8h-source.html#l00621">tcb::type</a>.    </td>
  </tr>
</table>
<a name="a7" doxytag="tcp.c::tcp_send"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> INT16 tcp_send </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">INT8&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>sockethandle</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>UINT8 *&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>buf</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>UINT16&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>blen</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>UINT16&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>dlen</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<dl compact><dt><b>Author: </b></dt><dd>
 <ul>
<li> Jari Lahti (<a href="mailto:jari.lahti@violasystems.com">jari.lahti@violasystems.com</a>) </ul>
</dl><dl compact><dt><b>Date: </b></dt><dd>
25.07.2002 </dl><dl compact><dt><b>Parameters: </b></dt><dd>
<table border=0 cellspacing=2 cellpadding=0>
<tr><td valign=top><em>sockethandle</em>&nbsp;</td><td>
handle to TCP socket to be used for sending data </td></tr>
<tr><td valign=top><em>buf</em>&nbsp;</td><td>
pointer to data buffer (start of user data) </td></tr>
<tr><td valign=top><em>blen</em>&nbsp;</td><td>
buffer length in bytes (without space reserved at the beginning of buffer for headers) </td></tr>
<tr><td valign=top><em>dlen</em>&nbsp;</td><td>
length of user data to be sent (in bytes) </td></tr>
</table>
</dl><dl compact><dt><b>Returns: </b></dt><dd>
 <ul>
<li> -1 - Error <li> &gt;0 - OK (number represents number of bytes actually sent)</ul>
</dl><dl compact><dt><b>Warning: </b></dt><dd>
 <ul>
<li> <em>buf</em> parameter is a pointer to data to be sent in  user buffer. But note that there <b>MUST</b> be sufficient free buffer space before that data for TCP header (of MIN_TCP_HLEN size).</ul>
</dl>Invoke this function to initiate data sending over TCP connection established over a TCP socket. Since data is not buffered (in order to reduce RAM memory consumption) new data can not be sent until data that was previously sent is acknowledged. So, application knows when it can send new data either by: <ul>
<li> waiting for TCP_EVENT_ACK in event_listener function <li> invoking tcp_check_send() function to check if it is possible to send data </ul>

<p>
Definition at line <a class="el" href="tcp_8c-source.html#l00481">481</a> of file <a class="el" href="tcp_8c-source.html">tcp.c</a>.
<p>
References <a class="el" href="tcp__ip_8h-source.html#l00627">tcb::myflags</a>, <a class="el" href="tcp_8c-source.html#l02119">process_tcp_out()</a>, <a class="el" href="tcp__ip_8h-source.html#l00629">tcb::send_mtu</a>, <a class="el" href="tcp__ip_8h-source.html#l00628">tcb::send_next</a>, <a class="el" href="tcp__ip_8h-source.html#l00626">tcb::send_unacked</a>, <a class="el" href="tcp__ip_8h-source.html#l00609">tcb::state</a>, and <a class="el" href="tcp__ip_8h-source.html#l00362">TCP_STATE_CONNECTED</a>.    </td>
  </tr>
</table>
<a name="a8" doxytag="tcp.c::tcp_close"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> INT8 tcp_close </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">INT8&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>&nbsp; <em>sochandle</em>          </td>
          <td class="md" valign="top">)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<dl compact><dt><b>Author: </b></dt><dd>
 <ul>
<li> Jari Lahti (<a href="mailto:jari.lahti@violasystems.com">jari.lahti@violasystems.com</a>) </ul>
</dl><dl compact><dt><b>Date: </b></dt><dd>
21.07.2002 </dl><dl compact><dt><b>Parameters: </b></dt><dd>
<table border=0 cellspacing=2 cellpadding=0>
<tr><td valign=top><em>sochandle</em>&nbsp;</td><td>
handle to socket on which TCP connection is to be closed </td></tr>
</table>
</dl><dl compact><dt><b>Returns: </b></dt><dd>
 <ul>
<li> -2 - there is unacked data on this socket. Try again later. <li> -1 - Error <li> &gt;=0 - OK (connection closing procedure started. Handle to socket returned)</ul>
</dl>Invoke this function to start connetion closing procedure over a given socket. Note that connection is not immediately closed. It may take some time for that to happen. Event_listener function will be invoked with  appropriate event when that really happens. 
<p>
Definition at line <a class="el" href="tcp_8c-source.html#l00549">549</a> of file <a class="el" href="tcp_8c-source.html">tcp.c</a>.
<p>
References <a class="el" href="tcp__ip_8h-source.html#l00622">tcb::flags</a>, <a class="el" href="tcp__ip_8h-source.html#l00627">tcb::myflags</a>, <a class="el" href="tcp__ip_8h-source.html#l00628">tcb::send_next</a>, <a class="el" href="tcp__ip_8h-source.html#l00626">tcb::send_unacked</a>, <a class="el" href="tcp__ip_8h-source.html#l00609">tcb::state</a>, <a class="el" href="tcp_8c-source.html#l02455">tcp_newstate()</a>, <a class="el" href="tcp_8c-source.html#l02253">tcp_sendcontrol()</a>, <a class="el" href="tcp__ip_8h-source.html#l00335">TCP_STATE_CLOSED</a>, <a class="el" href="tcp__ip_8h-source.html#l00353">TCP_STATE_CLOSING</a>, <a class="el" href="tcp__ip_8h-source.html#l00362">TCP_STATE_CONNECTED</a>, <a class="el" href="tcp__ip_8h-source.html#l00346">TCP_STATE_FINW1</a>, <a class="el" href="tcp__ip_8h-source.html#l00349">TCP_STATE_FINW2</a>, <a class="el" href="tcp__ip_8h-source.html#l00356">TCP_STATE_LAST_ACK</a>, <a class="el" href="tcp__ip_8h-source.html#l00336">TCP_STATE_LISTENING</a>, <a class="el" href="tcp__ip_8h-source.html#l00339">TCP_STATE_SYN_RECEIVED</a>, <a class="el" href="tcp__ip_8h-source.html#l00343">TCP_STATE_SYN_SENT</a>, and <a class="el" href="tcp__ip_8h-source.html#l00359">TCP_STATE_TIMED_WAIT</a>.    </td>
  </tr>
</table>
<a name="a9" doxytag="tcp.c::tcp_getstate"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> INT8 tcp_getstate </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">INT8&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>&nbsp; <em>sochandle</em>          </td>
          <td class="md" valign="top">)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<dl compact><dt><b>Author: </b></dt><dd>
 <ul>
<li> Jari Lahti (<a href="mailto:jari.lahti@violasystems.com">jari.lahti@violasystems.com</a>) </ul>
</dl><dl compact><dt><b>Date: </b></dt><dd>
21.07.2002 </dl><dl compact><dt><b>Parameters: </b></dt><dd>
<table border=0 cellspacing=2 cellpadding=0>
<tr><td valign=top><em>sochandle</em>&nbsp;</td><td>
handle to the socket to be queried </td></tr>
</table>
</dl><dl compact><dt><b>Returns: </b></dt><dd>
 <ul>
<li> -1 - Error <li> &gt;0 - Socket state</ul>
</dl>Use this function for querying socket state. This is usually not needed directly, but could be usefull for some special purposes. 
<p>
Definition at line <a class="el" href="tcp_8c-source.html#l00648">648</a> of file <a class="el" href="tcp_8c-source.html">tcp.c</a>.
<p>
References <a class="el" href="tcp__ip_8h-source.html#l00609">tcb::state</a>.    </td>
  </tr>
</table>
<a name="a10" doxytag="tcp.c::tcp_checksend"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> INT16 tcp_checksend </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">INT8&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>&nbsp; <em>sochandle</em>          </td>
          <td class="md" valign="top">)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<dl compact><dt><b>Author: </b></dt><dd>
 <ul>
<li> Jari Lahti (<a href="mailto:jari.lahti@violasystems.com">jari.lahti@violasystems.com</a>) </ul>
</dl><dl compact><dt><b>Date: </b></dt><dd>
23.07.2002 </dl><dl compact><dt><b>Parameters: </b></dt><dd>
<table border=0 cellspacing=2 cellpadding=0>
<tr><td valign=top><em>sochandle</em>&nbsp;</td><td>
handle to the socket to be inspected </td></tr>
</table>
</dl><dl compact><dt><b>Returns: </b></dt><dd>
 <ul>
<li> -1 - not possible to send over a socket (previously sent data is still not akcnowledged) <li> &gt;0 - it is possible to send data over a socket</ul>
</dl>Invoke this function to get information whether it is possible to send data or not. This may, sometimes, be preffered way of getting this type of information to waiting for <a class="el" href="tcp__ip_8h.html#a58">TCP_EVENT_ACK</a> in event_listener function. 
<p>
Definition at line <a class="el" href="tcp_8c-source.html#l00690">690</a> of file <a class="el" href="tcp_8c-source.html">tcp.c</a>.
<p>
References <a class="el" href="tcp__ip_8h-source.html#l00629">tcb::send_mtu</a>, <a class="el" href="tcp__ip_8h-source.html#l00628">tcb::send_next</a>, <a class="el" href="tcp__ip_8h-source.html#l00626">tcb::send_unacked</a>, <a class="el" href="tcp__ip_8h-source.html#l00609">tcb::state</a>, and <a class="el" href="tcp__ip_8h-source.html#l00362">TCP_STATE_CONNECTED</a>.    </td>
  </tr>
</table>
<a name="a11" doxytag="tcp.c::tcp_abort"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> INT8 tcp_abort </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">INT8&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>&nbsp; <em>sochandle</em>          </td>
          <td class="md" valign="top">)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<dl compact><dt><b>Author: </b></dt><dd>
 <ul>
<li> Jari Lahti (<a href="mailto:jari.lahti@violasystems.com">jari.lahti@violasystems.com</a>) </ul>
</dl><dl compact><dt><b>Date: </b></dt><dd>
21.07.2002 </dl><dl compact><dt><b>Parameters: </b></dt><dd>
<table border=0 cellspacing=2 cellpadding=0>
<tr><td valign=top><em>sochandle</em>&nbsp;</td><td>
handle to socket to be aborted </td></tr>
</table>
</dl><dl compact><dt><b>Returns: </b></dt><dd>
 <ul>
<li> -1 - error <li> &gt;=0 - OK (value represents handle to aborted socket)</ul>
</dl>Use this function in cases when TCP connection must be immediately closed. Note that the preffered (more elegant) way of closing the TCP connection is to invoke <a class="el" href="tcp_8c.html#a8">tcp_close()</a> which starts a proper closing procedure. tcp_abort should be used only in cases when it is really necessary to  immediately and quickly close the connection. 
<p>
Definition at line <a class="el" href="tcp_8c-source.html#l00736">736</a> of file <a class="el" href="tcp_8c-source.html">tcp.c</a>.
<p>
References <a class="el" href="tcp__ip_8h-source.html#l00627">tcb::myflags</a>, <a class="el" href="tcp__ip_8h-source.html#l00609">tcb::state</a>, <a class="el" href="tcp_8c-source.html#l02455">tcp_newstate()</a>, <a class="el" href="tcp_8c-source.html#l02253">tcp_sendcontrol()</a>, <a class="el" href="tcp__ip_8h-source.html#l00335">TCP_STATE_CLOSED</a>, <a class="el" href="tcp__ip_8h-source.html#l00353">TCP_STATE_CLOSING</a>, <a class="el" href="tcp__ip_8h-source.html#l00362">TCP_STATE_CONNECTED</a>, <a class="el" href="tcp__ip_8h-source.html#l00346">TCP_STATE_FINW1</a>, <a class="el" href="tcp__ip_8h-source.html#l00349">TCP_STATE_FINW2</a>, <a class="el" href="tcp__ip_8h-source.html#l00333">TCP_STATE_FREE</a>, <a class="el" href="tcp__ip_8h-source.html#l00356">TCP_STATE_LAST_ACK</a>, <a class="el" href="tcp__ip_8h-source.html#l00336">TCP_STATE_LISTENING</a>, <a class="el" href="tcp__ip_8h-source.html#l00334">TCP_STATE_RESERVED</a>, <a class="el" href="tcp__ip_8h-source.html#l00339">TCP_STATE_SYN_RECEIVED</a>, <a class="el" href="tcp__ip_8h-source.html#l00343">TCP_STATE_SYN_SENT</a>, and <a class="el" href="tcp__ip_8h-source.html#l00359">TCP_STATE_TIMED_WAIT</a>.    </td>
  </tr>
</table>
<a name="a12" doxytag="tcp.c::tcp_poll"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void tcp_poll </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">void&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>&nbsp;          </td>
          <td class="md" valign="top">)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<dl compact><dt><b>Author: </b></dt><dd>
 <ul>
<li> Jari Lahti (<a href="mailto:jari.lahti@violasystems.com">jari.lahti@violasystems.com</a>) </ul>
</dl><dl compact><dt><b>Date: </b></dt><dd>
19.07.2002 </dl><dl compact><dt><b>Warning: </b></dt><dd>
 <ul>
<li> This function <b>must be</b> invoked periodically from  the main loop. See <a class="el" href="main__demo_8c.html">main_demo.c</a> for an example.</ul>
</dl>This function checks all TCP sockets and performs various actions  if timeouts occur. What kind of action is performed is defined by the state of the TCP socket. 
<p>
Definition at line <a class="el" href="tcp_8c-source.html#l00808">808</a> of file <a class="el" href="tcp_8c-source.html">tcp.c</a>.
<p>
References <a class="el" href="timers_8c-source.html#l00233">check_timer()</a>, <a class="el" href="structtcb.html#m16">tcb::event_listener</a>, <a class="el" href="tcp__ip_8h-source.html#l00622">tcb::flags</a>, <a class="el" href="timers_8c-source.html#l00194">init_timer()</a>, <a class="el" href="tcp__ip_8h-source.html#l00627">tcb::myflags</a>, <a class="el" href="tcp__ip_8h-source.html#l00633">tcb::persist_timerh</a>, <a class="el" href="tcp__ip_8h-source.html#l00623">tcb::rem_ip</a>, <a class="el" href="tcp__ip_8h-source.html#l00624">tcb::remport</a>, <a class="el" href="tcp__ip_8h-source.html#l00634">tcb::retransmit_timerh</a>, <a class="el" href="tcp__ip_8h-source.html#l00635">tcb::retries_left</a>, <a class="el" href="tcp__ip_8h-source.html#l00629">tcb::send_mtu</a>, <a class="el" href="tcp__ip_8h-source.html#l00628">tcb::send_next</a>, <a class="el" href="tcp__ip_8h-source.html#l00626">tcb::send_unacked</a>, <a class="el" href="tcp__ip_8h-source.html#l00609">tcb::state</a>, <a class="el" href="tcp__ip_8h-source.html#l00189">TCP_DEF_RETRY_TOUT</a>, <a class="el" href="tcp__ip_8h-source.html#l00418">TCP_EVENT_ABORT</a>, <a class="el" href="tcp__ip_8h-source.html#l00405">TCP_EVENT_CLOSE</a>, <a class="el" href="tcp__ip_8h-source.html#l00437">TCP_EVENT_REGENERATE</a>, <a class="el" href="tcp_8c-source.html#l02455">tcp_newstate()</a>, <a class="el" href="tcp_8c-source.html#l02253">tcp_sendcontrol()</a>, <a class="el" href="tcp__ip_8h-source.html#l00335">TCP_STATE_CLOSED</a>, <a class="el" href="tcp__ip_8h-source.html#l00353">TCP_STATE_CLOSING</a>, <a class="el" href="tcp__ip_8h-source.html#l00362">TCP_STATE_CONNECTED</a>, <a class="el" href="tcp__ip_8h-source.html#l00346">TCP_STATE_FINW1</a>, <a class="el" href="tcp__ip_8h-source.html#l00349">TCP_STATE_FINW2</a>, <a class="el" href="tcp__ip_8h-source.html#l00333">TCP_STATE_FREE</a>, <a class="el" href="tcp__ip_8h-source.html#l00356">TCP_STATE_LAST_ACK</a>, <a class="el" href="tcp__ip_8h-source.html#l00336">TCP_STATE_LISTENING</a>, <a class="el" href="tcp__ip_8h-source.html#l00334">TCP_STATE_RESERVED</a>, <a class="el" href="tcp__ip_8h-source.html#l00339">TCP_STATE_SYN_RECEIVED</a>, <a class="el" href="tcp__ip_8h-source.html#l00343">TCP_STATE_SYN_SENT</a>, <a class="el" href="tcp__ip_8h-source.html#l00359">TCP_STATE_TIMED_WAIT</a>, <a class="el" href="tcp__ip_8h-source.html#l00206">TCP_SYN_RETRY_TOUT</a>, <a class="el" href="tcp__ip_8h-source.html#l00310">TCP_TYPE_SERVER</a>, <a class="el" href="timers_8h-source.html#l00086">TIMERTIC</a>, and <a class="el" href="tcp__ip_8h-source.html#l00621">tcb::type</a>.    </td>
  </tr>
</table>
<a name="a13" doxytag="tcp.c::tcp_init"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> INT8 tcp_init </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">void&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>&nbsp;          </td>
          <td class="md" valign="top">)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<dl compact><dt><b>Author: </b></dt><dd>
 <ul>
<li> Jari Lahti (<a href="mailto:jari.lahti@violasystems.com">jari.lahti@violasystems.com</a>) </ul>
</dl><dl compact><dt><b>Date: </b></dt><dd>
21.07.2002 </dl><dl compact><dt><b>Returns: </b></dt><dd>
 <ul>
<li> -1 - error <li> &gt;0 - number of sockets initialized </ul>
</dl><dl compact><dt><b>Warning: </b></dt><dd>
 <ul>
<li> This function <b>must</b> be invoked at startup before any other TCP functions are invoked.</ul>
</dl>This function initializes all sockets and corresponding tcbs to known state. Timers are also allocated for each socket and everything is brought to a predefined state. 
<p>
Definition at line <a class="el" href="tcp_8c-source.html#l01154">1154</a> of file <a class="el" href="tcp_8c-source.html">tcp.c</a>.
<p>
References <a class="el" href="structtcb.html#m16">tcb::event_listener</a>, <a class="el" href="tcp__ip_8h-source.html#l00622">tcb::flags</a>, <a class="el" href="timers_8c-source.html#l00131">get_timer()</a>, <a class="el" href="timers_8c-source.html#l00194">init_timer()</a>, <a class="el" href="tcp__ip_8h-source.html#l00625">tcb::locport</a>, <a class="el" href="tcp__ip_8h-source.html#l00627">tcb::myflags</a>, <a class="el" href="tcp__ip_8h-source.html#l00633">tcb::persist_timerh</a>, <a class="el" href="tcp__ip_8h-source.html#l00623">tcb::rem_ip</a>, <a class="el" href="tcp__ip_8h-source.html#l00624">tcb::remport</a>, <a class="el" href="tcp__ip_8h-source.html#l00634">tcb::retransmit_timerh</a>, <a class="el" href="tcp__ip_8h-source.html#l00635">tcb::retries_left</a>, <a class="el" href="tcp__ip_8h-source.html#l00629">tcb::send_mtu</a>, <a class="el" href="tcp__ip_8h-source.html#l00609">tcb::state</a>, <a class="el" href="tcp__ip_8h-source.html#l00333">TCP_STATE_FREE</a>, <a class="el" href="tcp__ip_8h-source.html#l00300">TCP_TYPE_NONE</a>, <a class="el" href="tcp__ip_8h-source.html#l00631">tcb::tos</a>, <a class="el" href="tcp__ip_8h-source.html#l00630">tcb::tout</a>, and <a class="el" href="tcp__ip_8h-source.html#l00621">tcb::type</a>.    </td>
  </tr>
</table>
<a name="a14" doxytag="tcp.c::process_tcp_in"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> INT16 process_tcp_in </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">struct <a class="el" href="structip__frame.html">ip_frame</a> *&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>frame</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>UINT16&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>len</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<dl compact><dt><b>Author: </b></dt><dd>
 <ul>
<li> Jari Lahti (<a href="mailto:jari.lahti@violasystems.com">jari.lahti@violasystems.com</a>) </ul>
</dl><dl compact><dt><b>Date: </b></dt><dd>
12.07.2002 </dl><dl compact><dt><b>Parameters: </b></dt><dd>
<table border=0 cellspacing=2 cellpadding=0>
<tr><td valign=top><em>frame</em>&nbsp;</td><td>
pointer to received <a class="el" href="structip__frame.html">ip_frame</a> structure </td></tr>
<tr><td valign=top><em>len</em>&nbsp;</td><td>
length of data contained in IP datagram (in bytes) </td></tr>
</table>
</dl><dl compact><dt><b>Returns: </b></dt><dd>
 <ul>
<li> -1 - Error (packet not OK, or not TCP,or something else) <li> &gt;0 - Packet OK</ul>
</dl>Invoke this function to process received TCP frames. See <a class="el" href="main__demo_8c.html">main_demo.c</a> for an example on how to accomplish this. 
<p>
Definition at line <a class="el" href="tcp_8c-source.html#l01250">1250</a> of file <a class="el" href="tcp_8c-source.html">tcp.c</a>.
<p>
References <a class="el" href="tcp__ip_8h-source.html#l00569">tcp_frame::ackno</a>, <a class="el" href="tcp__ip_8h-source.html#l00575">tcp_frame::buf_index</a>, <a class="el" href="ip_8h-source.html#l00126">ip_frame::buf_index</a>, <a class="el" href="tcp__ip_8h-source.html#l00572">tcp_frame::checksum</a>, <a class="el" href="tcp__ip_8h-source.html#l00567">tcp_frame::dport</a>, <a class="el" href="structtcb.html#m16">tcb::event_listener</a>, <a class="el" href="tcp__ip_8h-source.html#l00622">tcb::flags</a>, <a class="el" href="tcp__ip_8h-source.html#l00570">tcp_frame::hlen_flags</a>, <a class="el" href="ip_8h-source.html#l00074">IP_TCP</a>, <a class="el" href="tcp__ip_8h-source.html#l00627">tcb::myflags</a>, <a class="el" href="system_8h-source.html#l00270">NETWORK_RECEIVE_INITIALIZE</a>, <a class="el" href="tcp__ip_8h-source.html#l00574">tcp_frame::opt</a>, <a class="el" href="ip_8h-source.html#l00121">ip_frame::protocol</a>, <a class="el" href="system_8h-source.html#l00210">RECEIVE_NETWORK_B</a>, <a class="el" href="tcp__ip_8h-source.html#l00632">tcb::receive_next</a>, <a class="el" href="tcp__ip_8h-source.html#l00623">tcb::rem_ip</a>, <a class="el" href="tcp__ip_8h-source.html#l00624">tcb::remport</a>, <a class="el" href="system_8h-source.html#l00163">RESET_SYSTEM</a>, <a class="el" href="tcp__ip_8h-source.html#l00628">tcb::send_next</a>, <a class="el" href="tcp__ip_8h-source.html#l00626">tcb::send_unacked</a>, <a class="el" href="tcp__ip_8h-source.html#l00568">tcp_frame::seqno</a>, <a class="el" href="ip_8h-source.html#l00123">ip_frame::sip</a>, <a class="el" href="tcp__ip_8h-source.html#l00566">tcp_frame::sport</a>, <a class="el" href="tcp__ip_8h-source.html#l00609">tcb::state</a>, <a class="el" href="tcp_8c-source.html#l02567">tcp_check_cs()</a>, <a class="el" href="tcp__ip_8h-source.html#l00418">TCP_EVENT_ABORT</a>, <a class="el" href="tcp__ip_8h-source.html#l00428">TCP_EVENT_ACK</a>, <a class="el" href="tcp__ip_8h-source.html#l00405">TCP_EVENT_CLOSE</a>, <a class="el" href="tcp__ip_8h-source.html#l00397">TCP_EVENT_CONNECTED</a>, <a class="el" href="tcp__ip_8h-source.html#l00387">TCP_EVENT_CONREQ</a>, <a class="el" href="tcp__ip_8h-source.html#l00445">TCP_EVENT_DATA</a>, <a class="el" href="tcp_8c-source.html#l02346">tcp_initseq()</a>, <a class="el" href="tcp_8c-source.html#l02369">tcp_mapsocket()</a>, <a class="el" href="tcp_8c-source.html#l02455">tcp_newstate()</a>, <a class="el" href="tcp_8c-source.html#l02253">tcp_sendcontrol()</a>, <a class="el" href="tcp_8c-source.html#l02294">tcp_sendreset()</a>, <a class="el" href="tcp__ip_8h-source.html#l00335">TCP_STATE_CLOSED</a>, <a class="el" href="tcp__ip_8h-source.html#l00353">TCP_STATE_CLOSING</a>, <a class="el" href="tcp__ip_8h-source.html#l00362">TCP_STATE_CONNECTED</a>, <a class="el" href="tcp__ip_8h-source.html#l00346">TCP_STATE_FINW1</a>, <a class="el" href="tcp__ip_8h-source.html#l00349">TCP_STATE_FINW2</a>, <a class="el" href="tcp__ip_8h-source.html#l00333">TCP_STATE_FREE</a>, <a class="el" href="tcp__ip_8h-source.html#l00356">TCP_STATE_LAST_ACK</a>, <a class="el" href="tcp__ip_8h-source.html#l00336">TCP_STATE_LISTENING</a>, <a class="el" href="tcp__ip_8h-source.html#l00339">TCP_STATE_SYN_RECEIVED</a>, <a class="el" href="tcp__ip_8h-source.html#l00343">TCP_STATE_SYN_SENT</a>, <a class="el" href="tcp__ip_8h-source.html#l00359">TCP_STATE_TIMED_WAIT</a>, <a class="el" href="tcp__ip_8h-source.html#l00310">TCP_TYPE_SERVER</a>, <a class="el" href="tcp__ip_8h-source.html#l00621">tcb::type</a>, <a class="el" href="tcp__ip_8h-source.html#l00573">tcp_frame::urgent</a>, and <a class="el" href="tcp__ip_8h-source.html#l00571">tcp_frame::window</a>.    </td>
  </tr>
</table>
<a name="a15" doxytag="tcp.c::process_tcp_out"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> INT16 process_tcp_out </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">INT8&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>sockethandle</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>UINT8 *&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>buf</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>UINT16&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>blen</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>UINT16&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>dlen</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<dl compact><dt><b>Author: </b></dt><dd>
 <ul>
<li> Jari Lahti (<a href="mailto:jari.lahti@violasystems.com">jari.lahti@violasystems.com</a>) </ul>
</dl><dl compact><dt><b>Date: </b></dt><dd>
16.07.2002 </dl><dl compact><dt><b>Parameters: </b></dt><dd>
<table border=0 cellspacing=2 cellpadding=0>
<tr><td valign=top><em>sockethandle</em>&nbsp;</td><td>
handle to processed socket </td></tr>
<tr><td valign=top><em>buf</em>&nbsp;</td><td>
pointer to data buffer (where TCP header will be stored) </td></tr>
<tr><td valign=top><em>blen</em>&nbsp;</td><td>
buffer length in bytes </td></tr>
<tr><td valign=top><em>dlen</em>&nbsp;</td><td>
length of data in bytes </td></tr>
</table>
</dl><dl compact><dt><b>Returns: </b></dt><dd>
 <ul>
<li> -1 - Error <li> &gt;0 - Packet OK</ul>
</dl>Based on data supplied as function parameters and data stored in  socket's tcb, TCP header is created in buffer, checksum is calculated and packet is forwarded to lower layers (IP). 
<p>
Definition at line <a class="el" href="tcp_8c-source.html#l02119">2119</a> of file <a class="el" href="tcp_8c-source.html">tcp.c</a>.
<p>
References <a class="el" href="ip_8c-source.html#l00539">ip_checksum()</a>, <a class="el" href="ip_8c-source.html#l00582">ip_checksum_buf()</a>, <a class="el" href="ip_8h-source.html#l00074">IP_TCP</a>, <a class="el" href="tcp__ip_8h-source.html#l00625">tcb::locport</a>, <a class="el" href="tcp__ip_8h-source.html#l00627">tcb::myflags</a>, <a class="el" href="ip_8c-source.html#l00300">process_ip_out()</a>, <a class="el" href="tcp__ip_8h-source.html#l00632">tcb::receive_next</a>, <a class="el" href="tcp__ip_8h-source.html#l00623">tcb::rem_ip</a>, <a class="el" href="tcp__ip_8h-source.html#l00624">tcb::remport</a>, <a class="el" href="tcp__ip_8h-source.html#l00629">tcb::send_mtu</a>, <a class="el" href="tcp__ip_8h-source.html#l00626">tcb::send_unacked</a>, and <a class="el" href="tcp__ip_8h-source.html#l00631">tcb::tos</a>.
<p>
Referenced by <a class="el" href="tcp_8c-source.html#l00481">tcp_send()</a>, and <a class="el" href="tcp_8c-source.html#l02253">tcp_sendcontrol()</a>.    </td>
  </tr>
</table>
<a name="a16" doxytag="tcp.c::tcp_sendcontrol"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void tcp_sendcontrol </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">INT8&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>&nbsp; <em>sockethandle</em>          </td>
          <td class="md" valign="top">)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<dl compact><dt><b>Author: </b></dt><dd>
 <ul>
<li> Jari Lahti (<a href="mailto:jari.lahti@violasystems.com">jari.lahti@violasystems.com</a>) </ul>
</dl><dl compact><dt><b>Date: </b></dt><dd>
17.07.2002 </dl><dl compact><dt><b>Parameters: </b></dt><dd>
<table border=0 cellspacing=2 cellpadding=0>
<tr><td valign=top><em>sockethandle</em>&nbsp;</td><td>
handle to socket</td></tr>
</table>
</dl>This function is used to initiate sending of a control (no data) TCP  packet. Important thing in these packets are the flags and sequence numbers they carry. 
<p>
Definition at line <a class="el" href="tcp_8c-source.html#l02253">2253</a> of file <a class="el" href="tcp_8c-source.html">tcp.c</a>.
<p>
References <a class="el" href="tcp_8c-source.html#l02119">process_tcp_out()</a>, and <a class="el" href="tcp_8c-source.html#l00120">tcp_tempbuf</a>.
<p>
Referenced by <a class="el" href="tcp_8c-source.html#l01250">process_tcp_in()</a>, <a class="el" href="tcp_8c-source.html#l00736">tcp_abort()</a>, <a class="el" href="tcp_8c-source.html#l00549">tcp_close()</a>, <a class="el" href="tcp_8c-source.html#l00377">tcp_connect()</a>, <a class="el" href="tcp_8c-source.html#l00808">tcp_poll()</a>, and <a class="el" href="tcp_8c-source.html#l02294">tcp_sendreset()</a>.    </td>
  </tr>
</table>
<a name="a17" doxytag="tcp.c::tcp_sendreset"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void tcp_sendreset </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">struct <a class="el" href="structtcp__frame.html">tcp_frame</a> *&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>frame</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>UINT32&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>remip</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<dl compact><dt><b>Author: </b></dt><dd>
 <ul>
<li> Jari Lahti (<a href="mailto:jari.lahti@violasystems.com">jari.lahti@violasystems.com</a>) <li> Vladan Jovanovic (<a href="mailto:vladan.jovanovic@violasystems.com">vladan.jovanovic@violasystems.com</a>) </ul>
</dl><dl compact><dt><b>Date: </b></dt><dd>
20.08.2002 </dl><dl compact><dt><b>Parameters: </b></dt><dd>
<table border=0 cellspacing=2 cellpadding=0>
<tr><td valign=top><em>frame</em>&nbsp;</td><td>
pointer to received TCP packet </td></tr>
<tr><td valign=top><em>remip</em>&nbsp;</td><td>
remote IP address of packet</td></tr>
</table>
</dl>Uses socket <a class="el" href="group__opentcp__config.html#a5">NO_OF_TCPSOCKETS</a> to send a RESET packet to peer.  This function is used when we are establishing connection but we receive something else than SYN or SYN+ACK when it's possible that the peer has still old connection on which needs to be resetted without canceling the connection establishment on process. 
<p>
Definition at line <a class="el" href="tcp_8c-source.html#l02294">2294</a> of file <a class="el" href="tcp_8c-source.html">tcp.c</a>.
<p>
References <a class="el" href="tcp__ip_8h-source.html#l00569">tcp_frame::ackno</a>, <a class="el" href="tcp__ip_8h-source.html#l00567">tcp_frame::dport</a>, <a class="el" href="tcp__ip_8h-source.html#l00570">tcp_frame::hlen_flags</a>, <a class="el" href="tcp__ip_8h-source.html#l00625">tcb::locport</a>, <a class="el" href="tcp__ip_8h-source.html#l00627">tcb::myflags</a>, <a class="el" href="tcp__ip_8h-source.html#l00632">tcb::receive_next</a>, <a class="el" href="tcp__ip_8h-source.html#l00623">tcb::rem_ip</a>, <a class="el" href="tcp__ip_8h-source.html#l00624">tcb::remport</a>, <a class="el" href="tcp__ip_8h-source.html#l00629">tcb::send_mtu</a>, <a class="el" href="tcp__ip_8h-source.html#l00626">tcb::send_unacked</a>, <a class="el" href="tcp__ip_8h-source.html#l00568">tcp_frame::seqno</a>, <a class="el" href="tcp__ip_8h-source.html#l00566">tcp_frame::sport</a>, <a class="el" href="tcp_8c-source.html#l02253">tcp_sendcontrol()</a>, and <a class="el" href="tcp__ip_8h-source.html#l00631">tcb::tos</a>.
<p>
Referenced by <a class="el" href="tcp_8c-source.html#l01250">process_tcp_in()</a>.    </td>
  </tr>
</table>
<a name="a18" doxytag="tcp.c::tcp_initseq"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> UINT32 tcp_initseq </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">void&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>&nbsp;          </td>
          <td class="md" valign="top">)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<dl compact><dt><b>Author: </b></dt><dd>
 <ul>
<li> Jari Lahti (<a href="mailto:jari.lahti@violasystems.com">jari.lahti@violasystems.com</a>) </ul>
</dl><dl compact><dt><b>Date: </b></dt><dd>
17.07.2002 </dl><dl compact><dt><b>Returns: </b></dt><dd>
UINT32 number containing initial sequence number to be used</dl>This function returns initial sequence number to be used in a TCP  connection. For now, initial sequence number is selected based on base_timer value, which should be solid enough choice. 
<p>
Definition at line <a class="el" href="tcp_8c-source.html#l02346">2346</a> of file <a class="el" href="tcp_8c-source.html">tcp.c</a>.
<p>
Referenced by <a class="el" href="tcp_8c-source.html#l01250">process_tcp_in()</a>, and <a class="el" href="tcp_8c-source.html#l00377">tcp_connect()</a>.    </td>
  </tr>
</table>
<a name="a19" doxytag="tcp.c::tcp_mapsocket"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> INT8 tcp_mapsocket </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">struct <a class="el" href="structip__frame.html">ip_frame</a> *&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>ipframe</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>struct <a class="el" href="structtcp__frame.html">tcp_frame</a> *&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>tcpframe</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<dl compact><dt><b>Author: </b></dt><dd>
 <ul>
<li> Jari Lahti (<a href="mailto:jari.lahti@violasystems.com">jari.lahti@violasystems.com</a>) </ul>
</dl><dl compact><dt><b>Date: </b></dt><dd>
12.07.2002 </dl><dl compact><dt><b>Parameters: </b></dt><dd>
<table border=0 cellspacing=2 cellpadding=0>
<tr><td valign=top><em>ipframe</em>&nbsp;</td><td>
pointer to received IP frame </td></tr>
<tr><td valign=top><em>tcpframe</em>&nbsp;</td><td>
pointer to received TCP frame to be mapped </td></tr>
</table>
</dl><dl compact><dt><b>Returns: </b></dt><dd>
 <ul>
<li> -1 - Error (no resources or no socket found) <li> &gt;=0 - Handle to mapped socket</ul>
</dl>Function iterates through socket table trying to find a socket for  whom this TCP packet is intended. 
<p>
Definition at line <a class="el" href="tcp_8c-source.html#l02369">2369</a> of file <a class="el" href="tcp_8c-source.html">tcp.c</a>.
<p>
References <a class="el" href="tcp__ip_8h-source.html#l00567">tcp_frame::dport</a>, <a class="el" href="tcp__ip_8h-source.html#l00570">tcp_frame::hlen_flags</a>, <a class="el" href="tcp__ip_8h-source.html#l00625">tcb::locport</a>, <a class="el" href="tcp__ip_8h-source.html#l00623">tcb::rem_ip</a>, <a class="el" href="tcp__ip_8h-source.html#l00624">tcb::remport</a>, <a class="el" href="ip_8h-source.html#l00123">ip_frame::sip</a>, <a class="el" href="tcp__ip_8h-source.html#l00566">tcp_frame::sport</a>, <a class="el" href="tcp__ip_8h-source.html#l00609">tcb::state</a>, and <a class="el" href="tcp__ip_8h-source.html#l00336">TCP_STATE_LISTENING</a>.
<p>
Referenced by <a class="el" href="tcp_8c-source.html#l01250">process_tcp_in()</a>.    </td>
  </tr>
</table>
<a name="a20" doxytag="tcp.c::tcp_newstate"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void tcp_newstate </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">struct <a class="el" href="structtcb.html">tcb</a> *&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>soc</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>UINT8&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>nstate</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<dl compact><dt><b>Author: </b></dt><dd>
 <ul>
<li> Jari Lahti (<a href="mailto:jari.lahti@violasystems.com">jari.lahti@violasystems.com</a>) </ul>
</dl><dl compact><dt><b>Date: </b></dt><dd>
18.07.2002 </dl><dl compact><dt><b>Parameters: </b></dt><dd>
<table border=0 cellspacing=2 cellpadding=0>
<tr><td valign=top><em>soc</em>&nbsp;</td><td>
pointer to socket structure we're working with </td></tr>
<tr><td valign=top><em>nstate</em>&nbsp;</td><td>
new socket state</td></tr>
</table>
</dl>This function is used for every state-change that occurs in the TCP sockets so as to provide correct timers/retransmittions that ensure TCP connection is lasting. 
<p>
Definition at line <a class="el" href="tcp_8c-source.html#l02455">2455</a> of file <a class="el" href="tcp_8c-source.html">tcp.c</a>.
<p>
References <a class="el" href="timers_8c-source.html#l00194">init_timer()</a>, <a class="el" href="tcp__ip_8h-source.html#l00633">tcb::persist_timerh</a>, <a class="el" href="tcp__ip_8h-source.html#l00634">tcb::retransmit_timerh</a>, <a class="el" href="tcp__ip_8h-source.html#l00635">tcb::retries_left</a>, <a class="el" href="tcp__ip_8h-source.html#l00609">tcb::state</a>, <a class="el" href="tcp__ip_8h-source.html#l00160">TCP_DEF_RETRIES</a>, <a class="el" href="tcp__ip_8h-source.html#l00189">TCP_DEF_RETRY_TOUT</a>, <a class="el" href="tcp__ip_8h-source.html#l00198">TCP_INIT_RETRY_TOUT</a>, <a class="el" href="tcp__ip_8h-source.html#l00353">TCP_STATE_CLOSING</a>, <a class="el" href="tcp__ip_8h-source.html#l00362">TCP_STATE_CONNECTED</a>, <a class="el" href="tcp__ip_8h-source.html#l00346">TCP_STATE_FINW1</a>, <a class="el" href="tcp__ip_8h-source.html#l00349">TCP_STATE_FINW2</a>, <a class="el" href="tcp__ip_8h-source.html#l00356">TCP_STATE_LAST_ACK</a>, <a class="el" href="tcp__ip_8h-source.html#l00343">TCP_STATE_SYN_SENT</a>, <a class="el" href="tcp__ip_8h-source.html#l00359">TCP_STATE_TIMED_WAIT</a>, <a class="el" href="timers_8h-source.html#l00086">TIMERTIC</a>, and <a class="el" href="tcp__ip_8h-source.html#l00630">tcb::tout</a>.
<p>
Referenced by <a class="el" href="tcp_8c-source.html#l01250">process_tcp_in()</a>, <a class="el" href="tcp_8c-source.html#l00736">tcp_abort()</a>, <a class="el" href="tcp_8c-source.html#l00549">tcp_close()</a>, <a class="el" href="tcp_8c-source.html#l00377">tcp_connect()</a>, and <a class="el" href="tcp_8c-source.html#l00808">tcp_poll()</a>.    </td>
  </tr>
</table>
<a name="a21" doxytag="tcp.c::tcp_getfreeport"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> UINT16 tcp_getfreeport </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">void&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>&nbsp;          </td>
          <td class="md" valign="top">)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<dl compact><dt><b>Author: </b></dt><dd>
 <ul>
<li> Jari Lahti (<a href="mailto:jari.lahti@violasystems.com">jari.lahti@violasystems.com</a>) </ul>
</dl><dl compact><dt><b>Date: </b></dt><dd>
21.07.2002 </dl><dl compact><dt><b>Returns: </b></dt><dd>
 <ul>
<li> 0 - no free ports! <li> &gt;0 - free local TCP port number</ul>
</dl>Function attempts to find new local port number that can be used to  establish a connection. 
<p>
Definition at line <a class="el" href="tcp_8c-source.html#l02511">2511</a> of file <a class="el" href="tcp_8c-source.html">tcp.c</a>.
<p>
References <a class="el" href="tcp__ip_8h-source.html#l00625">tcb::locport</a>, <a class="el" href="tcp__ip_8h-source.html#l00609">tcb::state</a>, <a class="el" href="tcp__ip_8h-source.html#l00100">TCP_PORTS_END</a>, and <a class="el" href="tcp__ip_8h-source.html#l00335">TCP_STATE_CLOSED</a>.
<p>
Referenced by <a class="el" href="tcp_8c-source.html#l00377">tcp_connect()</a>.    </td>
  </tr>
</table>
<a name="a22" doxytag="tcp.c::tcp_check_cs"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> UINT8 tcp_check_cs </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">struct <a class="el" href="structip__frame.html">ip_frame</a> *&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>ipframe</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>UINT16&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>len</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<dl compact><dt><b>Author: </b></dt><dd>
 <ul>
<li> Jari Lahti (<a href="mailto:jari.lahti@violasystems.com">jari.lahti@violasystems.com</a>) </ul>
</dl><dl compact><dt><b>Date: </b></dt><dd>
16.07.2002 </dl><dl compact><dt><b>Parameters: </b></dt><dd>
<table border=0 cellspacing=2 cellpadding=0>
<tr><td valign=top><em>ipframe</em>&nbsp;</td><td>
pointer to IP frame that carried TCP message </td></tr>
<tr><td valign=top><em>len</em>&nbsp;</td><td>
length of TCP portion  </td></tr>
</table>
</dl><dl compact><dt><b>Returns: </b></dt><dd>
 <ul>
<li> 0 - checksum corrupted <li> 1 - checksum OK</ul>
</dl>Function recalculates TCP checksum (pseudoheader+header+data) and  compares it to received checksum to see if everything is OK or there  is a problem with the checksum. 
<p>
Definition at line <a class="el" href="tcp_8c-source.html#l02567">2567</a> of file <a class="el" href="tcp_8c-source.html">tcp.c</a>.
<p>
References <a class="el" href="ip_8h-source.html#l00124">ip_frame::dip</a>, <a class="el" href="ip_8c-source.html#l00539">ip_checksum()</a>, <a class="el" href="ip_8c-source.html#l00582">ip_checksum_buf()</a>, <a class="el" href="ip_8h-source.html#l00121">ip_frame::protocol</a>, <a class="el" href="system_8h-source.html#l00210">RECEIVE_NETWORK_B</a>, <a class="el" href="system_8h-source.html#l00220">RECEIVE_NETWORK_BUF</a>, <a class="el" href="ip_8h-source.html#l00123">ip_frame::sip</a>, and <a class="el" href="tcp_8c-source.html#l00120">tcp_tempbuf</a>.
<p>
Referenced by <a class="el" href="tcp_8c-source.html#l01250">process_tcp_in()</a>.    </td>
  </tr>
</table>
<hr><h2>Variable Documentation</h2>
<a name="a0" doxytag="tcp.c::received_tcp_packet"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> struct <a class="el" href="structtcp__frame.html">tcp_frame</a> received_tcp_packet
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Various fields from the TCP packet are stored in this variable. These values are then used to perform the necessary actions as defined  by the TCP specification: correctnes of the received TCP packet is checked by analyzing these fields, appropriate socket data is adjusted and/or control packet is sent based on it. See <a class="el" href="structtcp__frame.html">tcp_frame</a> definition  for struct information. 
<p>
Definition at line <a class="el" href="tcp_8c-source.html#l00102">102</a> of file <a class="el" href="tcp_8c-source.html">tcp.c</a>.    </td>
  </tr>
</table>
<a name="a1" doxytag="tcp.c::tcp_socket"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> struct <a class="el" href="structtcb.html">tcb</a> tcp_socket[NO_OF_TCPSOCKETS + 1]
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
TCP table is an array of tcp_socket structures holding all of the  necessary information about the state, timers, timeouts and sequence and port numbers of the TCP sockets opened. Number of TCP sockets that can be opened at any given time is defined by the <a class="el" href="group__opentcp__config.html#a5">NO_OF_TCPSOCKETS</a> and may be changed in order to change the amount of used RAM memory. See tcb definition for more information about the structure itself.
<p>
<dl compact><dt><b>Note: </b></dt><dd>
As seen in the code, an array size is actually bigger for one than the <a class="el" href="group__opentcp__config.html#a5">NO_OF_TCPSOCKETS</a> defines. The last entry is used for sending control packets as answers to incoming TCP packets that do not map  to any existing TCP sockets. </dl>
<p>
Definition at line <a class="el" href="tcp_8c-source.html#l00118">118</a> of file <a class="el" href="tcp_8c-source.html">tcp.c</a>.    </td>
  </tr>
</table>
<a name="a2" doxytag="tcp.c::tcp_tempbuf"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> UINT8 tcp_tempbuf[MIN_TCP_HLEN + 1]
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Temporary buffer used for sending TCP control packets 
<p>
Definition at line <a class="el" href="tcp_8c-source.html#l00120">120</a> of file <a class="el" href="tcp_8c-source.html">tcp.c</a>.
<p>
Referenced by <a class="el" href="tcp_8c-source.html#l02567">tcp_check_cs()</a>, and <a class="el" href="tcp_8c-source.html#l02253">tcp_sendcontrol()</a>.    </td>
  </tr>
</table>
<hr><address style="align: right;"><small>Generated on Sun Aug 3 20:33:00 2003 for OpenTCP by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.18 </small></address>
</body>
</html>
